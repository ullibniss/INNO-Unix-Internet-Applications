# Lab 2.

## Done by Fedorov Alexey

# Task 1. Downloading and Installing a Caching Name Server

The sources for the latest version:
- BIND - https://www.isc.org/bind/
- Unbound - https://nlnetlabs.nl/projects/unbound/about/
- NSD will be installed later.

## 1.1 Validating the Download

```
The https://www.isc.org website provides signature files in addition to the BIND tarball.
These can be used to check if you have downloaded the version they intended to
distribute. The Unbound website uses a different mechanism, in particular, a
modification detection code, better known as a cryptographic hash.
```

## Why is it wise to verify your download?

Verifying the download ensures that the software has not been tampered with and is exactly what the developers intended to distribute. This protects against malware or corrupted files.

## Which mechanism is the best one to use (signatures or hashes)? Why?

Signatures provide a higher level of security as they are tied to the private key of the distributor, confirming authenticity. Hashes are faster to compute but vulnerable to collision attacks if not securely obtained.

## Download the Unbound+NSD and check its validity using one of the signatures.

### Unbound

Downloaded Unbound and SHA256 hash.

![image](https://github.com/user-attachments/assets/2ee11706-4629-4e8d-ae88-6ab3bc35e2fc)

Validated downloaded archive.

![image](https://github.com/user-attachments/assets/c8956d03-e440-40af-98ca-6ee121964e0f)


## 1.2 - Documentation & Compiling

### Unbound

Configuring unbound, using configure command.

`sudo ./configure --prefix=/usr/local --sysconfdir=/usr/local/etc/unbound --localstatedir=/var/run`

![image](https://github.com/user-attachments/assets/5a243574-b318-4316-af53-b3a268ec2e65)

![image](https://github.com/user-attachments/assets/c75a9c6f-9b5d-462c-a4ab-4b0231a0a52a)

Applying `make`.

![image](https://github.com/user-attachments/assets/051c11b3-776a-496e-a411-6f3121d44b8c)

![image](https://github.com/user-attachments/assets/46cb3f77-6adb-49ee-b1a1-72e745c697cf)

Applying `make install`.

![image](https://github.com/user-attachments/assets/0be81d83-c5d0-4193-87d1-7e441114c9c6)

![image](https://github.com/user-attachments/assets/495d1130-9ee7-4cac-9c11-974cf11206a1)

## What is the difference between /etc, /usr/etc, /usr/local/etc?

- `/etc`: Default system-wide configuration.
- `/usr/etc`: Legacy or distribution-specific configurations.
- `/usr/local/etc`: Used for user-installed software, avoiding conflicts with system packages.

# Task 2. Configuring Caching Name Server.

## Why are caching-only name servers useful?

- Reduce query latency by storing frequently accessed DNS records.
- Decrease upstream bandwidth usage.
- Provide resilience by serving cached data during upstream failures.

## Root.hints

I downloaded root hints from `ftp.rs.internic.net`.

`wget ftp://ftp.rs.internic.net/domain/named.cache -O /usr/local/etc/unbound/root.hints`

![image](https://github.com/user-attachments/assets/d482a044-168f-4bf2-a2ae-544391d39993)

## Unbound configuration

I configured unbound the following way:

![image](https://github.com/user-attachments/assets/ac99d41c-6380-47b3-b313-b6eba9331fd6)

I also checked errors in configuration file.

![image](https://github.com/user-attachments/assets/933943a0-91bc-4f17-8379-cd1f17c59ef2)

## Why is access control important for recursive server?

1. **Prevent Abuse**: Stops unauthorized users from exploiting the server for DDoS or amplification attacks.
2. **Protect Privacy**: Shields cached DNS data from unauthorized access.
3. **Conserve Resources**: Reduces load by limiting queries to trusted clients.
4. **Enhance Security**: Prevents cache poisoning and other attacks.
5. **Ensure Compliance**: Meets security regulations and best practices.

Restrict access to trusted IP ranges and monitor activity for optimal performance and safety.

## Why do the programs return a result value?

This is an exit code. The program usually returns 1 if it encountered an error and 0 if it finished successfully. In this case, the program is considered to have finished with an error if any syntax errors were detected during the check.

# Task 3. Running Caching Name Server

## Running by hand

Let's try to start server by hand.

![image](https://github.com/user-attachments/assets/45fef0d8-1bfa-46d6-a1f5-554d962486cf)

Wow, it started !

## Configuring unbound-control

I will setup unbound-control with `unbound-control-setup`. This command will create keys and cetrificates for client-server interaction.

![image](https://github.com/user-attachments/assets/3e58c642-15e6-4739-832d-b80bd5eb35f6)

## Unbound configuration

I added keys generated by unbound-control-setup.

![image](https://github.com/user-attachments/assets/3c1f66b7-9def-4fb3-afd4-bfb5c7a21c97)

Verify connection.

![image](https://github.com/user-attachments/assets/d801ca8a-1ef6-4b79-ac8f-d41b1868f603)

It works!

## What other commands/functions does rndc/unbound-control provide?

- `unbound-control start` - Start the server.
- `unbound-control stop` - Stop the server.
- `unbound-control reload` - Reload the configuration.

Moreover, `unbound-control` provides many command to flush cache, collect stats, listing zones and other data.

## What is the difference between stop -> start and reload?

- Stop â†’ Start: Restarts the entire server.
- Reload: Applies configuration changes without interrupting current operations.

## What do you need to put in resolv.conf (and/or other files) to use your own name server?

I simply edited file `/etc/resolv.conf`.

![image](https://github.com/user-attachments/assets/c5226a90-9e43-4b18-857c-1eafacc002d8)

Let's test.

![image](https://github.com/user-attachments/assets/7d26f4a9-7fbf-432e-abdc-98316b430118)

Server works!

# Task 4. Authoritative Name Server

I created second VM.

![image](https://github.com/user-attachments/assets/4430a046-9d07-4e7f-9ae6-f539a9fe198c)

### NSD Download and validation

Downloaded NSD and SHA256 hash.

![image](https://github.com/user-attachments/assets/11461bb5-3215-42c1-926b-e909da6aa47b)

Validated downloaded archive.

### Compiling NSD

Configuring nsd, using configure command.

`sudo ./configure --prefix=/usr/local --sysconfdir=/usr/local/etc --localstatedir=/var/run`

![image](https://github.com/user-attachments/assets/758728d4-71f8-4a39-8ccf-a97b2f8a521f)

![image](https://github.com/user-attachments/assets/f9e6e865-824f-4fc2-bca6-c22a32f3408f)

Applying `make`.

![image](https://github.com/user-attachments/assets/23dc3751-1116-4d85-9ebf-165ad9736bc5)

![image](https://github.com/user-attachments/assets/0c817261-7ec6-4f8d-a111-822b86662ffd)

Applying `make install`.

![image](https://github.com/user-attachments/assets/02fee639-b5f9-4d08-ae89-2244fe2b3cef)


## NSD directories

Let's create the required directories for NSD.

![image](https://github.com/user-attachments/assets/8e9d4a5f-6663-4e16-a571-a6e8c792aa0a)

## NSD configuration

I created the NSD configuration file in `/usr/local/etc/nsd/nsd.conf`.

![image](https://github.com/user-attachments/assets/c51017ad-f472-4cfd-ae1b-de531ca74b58)

It contains consists of base server confguration and zones. Each zone has it's own file.

## First zone file

The zone file defines the records for domain. I created `/usr/local/etc/nsd/st17.sne24.ru.zone`.

![image](https://github.com/user-attachments/assets/43ba768b-67c2-4f2a-b34b-f0cf2a1cbe2d)

## What is a private DNS zone? Is st17.sne23.ru private?

A private DNS zone is used to manage DNS records within a private network and is not accessible from the public internet. These zones are common in internal corporate networks or private cloud environments.

Yes, st17.sne23.ru is only accessible within a local network.

## What information was needed by TAs so they can implement the delegation?

1. Subdomain - st17.sne23.ru
2. NS Record - ns.st17.sne23.ru
3. IP Address of the authoritative server - 192.168.1.1

## Testing the solution

I aslo added delegate for unbound.

![image](https://github.com/user-attachments/assets/99ac794d-2a5a-45cb-b631-b023c65d7acd)

Now if unbound will receive request for s17.sne23.ru, it will not search it on root servers, it will immediately search on local authoritative DNS server.

More over, I configured unbound as DNS server (in /etc/resolv.conf) on nsd virtual machine. It provides ability to test the following chain:

`request -> cache -> authoritive server`

Let's test. First of all requests from vm2.

`dig s17.sne24.ru`

![image](https://github.com/user-attachments/assets/d10386ef-c729-46ac-acc2-23fdc6e6c268)

`dig api.st17.sne24.ru`

![image](https://github.com/user-attachments/assets/d22cbba5-52cb-468c-800a-2d56f08ad5c3)

`dig www.st17.sne24.ru`

![image](https://github.com/user-attachments/assets/20f51276-824c-4ac4-8a72-17a2a1a636c0)

`dig main.st17.sne24.ru`

![image](https://github.com/user-attachments/assets/dbda4e2b-5db4-49b3-a6a1-0bbe1d15be92)

From vm1.

`dig s17.sne24.ru`

![image](https://github.com/user-attachments/assets/1faf468a-aed8-4c1a-802f-7abbdc908cb9)

`dig admin.st17.sne24.ru`

![image](https://github.com/user-attachments/assets/3717e731-2a0d-4ecc-a4d8-b36b3524ceb2)

`dig www.st17.sne24.ru`

![image](https://github.com/user-attachments/assets/557c1c86-39e6-48cf-8964-d720f349916a)

`dig api.st17.sne24.ru`

![image](https://github.com/user-attachments/assets/95ff8be4-a2c8-4aa4-89cd-d3c04333453b)


# References

1. https://unbound.docs.nlnetlabs.nl/en/latest/getting-started/configuration.html
2. https://nlnetlabs.nl/documentation/nsd/nsd/
3. https://stackoverflow.com/questions/17833091/cannot-find-ssl-libraries
4. https://stackoverflow.com/questions/21557166/libexpat-could-not-be-found-by-linux-system
5. https://stackoverflow.com/questions/21926202/libevent-not-found-error-in-tmux
6. https://www.internic.net/domain/named.root
7. https://www.8host.com/blog/nastrojka-master-servera-nsd-v-ubuntu-14-04/
